За основу берём Debian 12, обновляем до бекпортов, выделяем 2 ядро, 2Гб ОЗУ и 15Гб места


Подготовка ноды
# apt install --no-install-recommends containerd
# nano /etc/containerd/config.toml

version = 2

[plugins]
  [plugins."io.containerd.grpc.v1.cri"]
    [plugins."io.containerd.grpc.v1.cri".cni]
      bin_dir = "/opt/cni/bin"
      conf_dir = "/etc/cni/net.d"
  [plugins."io.containerd.internal.v1.opt"]
    path = "/var/lib/containerd/opt"
  [plugins."io.containerd.grpc.v1.cri".containerd]
    [plugins."io.containerd.grpc.v1.cri".containerd.runtimes]
      [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
        runtime_type = "io.containerd.runc.v2"
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]
           SystemdCgroup = true

# nano /etc/modules-load.d/k8s.conf

br_netfilter

# modprobe br_netfilter
# nano /etc/sysctl.d/k8s.conf

net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1

# sysctl --system


Инициализация мастера
kubeadm init --config kubeadm-config.yaml

# Ставим cni
curl -L --remote-name-all https://github.com/cilium/cilium-cli/releases/latest/download/cilium-linux-amd64.tar.gz{,.sha256sum}
sha256sum --check cilium-linux-amd64.tar.gz.sha256sum
tar xzvfC cilium-linux-amd64.tar.gz /usr/local/bin
rm cilium-linux-amd64.tar.gz{,.sha256sum}
cilium install --config ipam=kubernetes

# устанавливаем ингрес
k edit node k8s-ingress195
metadata:
...
  labels:
...
    node-role.kubernetes.io/ingress: ""
spec:
...
  taints:
  - effect: NoSchedule
    key: node-role.kubernetes.io/ingress

helm upgrade --install ingress-nginx ingress-nginx   --repo https://kubernetes.github.io/ingress-nginx   --namespace ingress-nginx --create-namespace -f ingress/values.yaml
